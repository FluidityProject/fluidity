cmake_minimum_required(VERSION 3.10)
enable_language (Fortran CXX)
set(CMAKE_RUNTIME_OUTPUT_DIRECTORY ${CMAKE_BINARY_DIR}/bin/tests)

file(GLOB tests RELATIVE ${CMAKE_CURRENT_SOURCE_DIR} *.F90)
list(REMOVE_ITEM tests test_anisotropic_adaptivity.F90 test_anisotropic_adaptivity_two test_gradation.F90 test_isotropic_gradation.F90 test_annulus_gradation.F90 test_directional_gradation.F90 test_directional_gradation_annulus.F90 test_pseudo2d_gradation.F90 test_assemble_metric.F90 test_anisotropically_bounded_metric.F90 test_backstep.F90 test_quadratic_interpolation.F90 test_recovery_estimator.F90 test_elementwise_error_adaptivity.F90 test_boundary_layer_adaptivity.F90 test_boundary_layer_adaptivity_two.F90 test_anisotropic_bounds_equivalence.F90 compute_interpolation_error_noadapt.F90 compute_interpolation_error_adapt.F90 compute_enstrophy_goal.F90 compute_temperature_goal.F90 compute_hessian_error.F90 compute_chimney_adapt.F90 compute_les_temp_goal.F90 compute_les_velocity_goal.F90 compute_mesh_conformity.F90 compute_driven_cavity_adapt.F90 test_mba compute_residual.F90 test_metric_advection.F90 test_geometric_constraints.F90 compute_compare_interpolation.F90 compute_compare_interpolation_3d.F90 test_anisotropic_gradation.F90 compute_anisotropic_gradation.F90 test_anisotropic_zz_3d.F90 test_anisotropic_zz.F90)
foreach(unittest IN LISTS tests)
   get_filename_component(test_name ${unittest} NAME_WE)
   add_library(${test_name}_main OBJECT test_main.cpp)
   set_target_properties(${test_name}_main PROPERTIES COMPILE_FLAGS -DTESTNAME=${test_name}_)
   add_executable(${test_name} ${unittest} $<TARGET_OBJECTS:${test_name}_main>)
   target_link_libraries(${test_name} fluidity ${FLUIDITY_PACKAGE_LIBS})
   list(APPEND unittests ${test_name})
endforeach()

set(error_measures_unittests ${unittests} PARENT_SCOPE)
